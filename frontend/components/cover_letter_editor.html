<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cover Letter Editor - Constraint-Optimized</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .cover-letter-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .cover-letter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 16px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .constraints-display {
            display: flex;
            gap: 20px;
        }

        .constraint-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .constraint-value {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .constraint-value.warning {
            color: #f59e0b;
        }

        .constraint-value.danger {
            color: #ef4444;
        }

        .constraint-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .alignment-score {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .score-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            color: white;
            background: conic-gradient(from 0deg, #10b981 0deg, #10b981 var(--score-angle), #e5e7eb var(--score-angle));
        }

        .score-circle.excellent {
            --score-angle: 324deg; /* 90% */
            background: conic-gradient(from 0deg, #10b981 0deg, #10b981 var(--score-angle), #e5e7eb var(--score-angle));
        }

        .score-circle.good {
            --score-angle: 288deg; /* 80% */
            background: conic-gradient(from 0deg, #3b82f6 0deg, #3b82f6 var(--score-angle), #e5e7eb var(--score-angle));
        }

        .score-circle.fair {
            --score-angle: 252deg; /* 70% */
            background: conic-gradient(from 0deg, #f59e0b 0deg, #f59e0b var(--score-angle), #e5e7eb var(--score-angle));
        }

        .score-circle.poor {
            --score-angle: 216deg; /* 60% */
            background: conic-gradient(from 0deg, #ef4444 0deg, #ef4444 var(--score-angle), #e5e7eb var(--score-angle));
        }

        .score-details {
            display: flex;
            flex-direction: column;
        }

        .score-label {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 4px;
        }

        .score-breakdown {
            font-size: 12px;
            color: #64748b;
        }

        .cover-letter-editor {
            margin-bottom: 24px;
        }

        .section {
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .section-title {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-stats {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #64748b;
        }

        .editable-content {
            padding: 16px;
            min-height: 80px;
            border: none;
            outline: none;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            background: white;
        }

        .editable-content:focus {
            background: #fefce8;
            border-left: 3px solid #eab308;
        }

        .editable-content[contenteditable="true"]:empty::before {
            content: attr(data-placeholder);
            color: #94a3b8;
            font-style: italic;
        }

        .section-recommendations {
            padding: 12px 16px;
            background: #fef3c7;
            border-top: 1px solid #f59e0b;
            font-size: 12px;
            color: #92400e;
        }

        .recommendation-item {
            margin-bottom: 4px;
        }

        .recommendation-item:last-child {
            margin-bottom: 0;
        }

        .cover-letter-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            padding: 20px 0;
            border-top: 1px solid #e2e8f0;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .action-btn.primary {
            background: #3b82f6;
            color: white;
        }

        .action-btn.primary:hover {
            background: #2563eb;
        }

        .action-btn.secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #cbd5e1;
        }

        .action-btn.secondary:hover {
            background: #e2e8f0;
        }

        .action-btn.warning {
            background: #f59e0b;
            color: white;
        }

        .action-btn.warning:hover {
            background: #d97706;
        }

        .live-preview {
            margin-top: 24px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .preview-header {
            font-weight: 600;
            margin-bottom: 16px;
            color: #1e293b;
        }

        .preview-content {
            font-family: 'Times New Roman', serif;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-line;
            color: #374151;
        }

        .constraint-violation {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }

        .auto-save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: #10b981;
            color: white;
            border-radius: 20px;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        .constraints-edit-btn {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }

        .constraints-edit-btn:hover {
            background: #e2e8f0;
            transform: rotate(90deg);
        }

        .constraints-editor {
            margin-bottom: 20px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            display: none;
        }

        .constraints-editor.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .constraints-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .constraints-editor-title {
            font-weight: 600;
            color: #1e293b;
            font-size: 16px;
        }

        .constraints-presets {
            display: flex;
            gap: 8px;
        }

        .preset-btn {
            padding: 6px 12px;
            border: 1px solid #cbd5e1;
            background: white;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: #f1f5f9;
        }

        .preset-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .constraints-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .constraint-group {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 16px;
        }

        .constraint-group-title {
            font-weight: 500;
            color: #374151;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .constraint-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .constraint-input {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .constraint-input label {
            font-size: 12px;
            color: #64748b;
            flex: 1;
        }

        .constraint-input input {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }

        .constraints-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .constraints-info {
            font-size: 12px;
            color: #64748b;
        }

        @media (max-width: 768px) {
            .cover-letter-header {
                flex-direction: column;
                gap: 16px;
            }

            .constraints-display {
                justify-content: center;
            }

            .cover-letter-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="cover-letter-container">
        <!-- Header with constraints and score -->
        <div class="cover-letter-header">
            <div class="constraints-display">
                <div class="constraint-item">
                    <div class="constraint-value" id="line-count">24</div>
                    <div class="constraint-label">Lines (<span id="max-lines">29</span> max)</div>
                </div>
                <div class="constraint-item">
                    <div class="constraint-value" id="char-count">1,156</div>
                    <div class="constraint-label">Characters (<span id="max-chars">1,300</span> max)</div>
                </div>
                <div class="constraint-item">
                    <button class="constraints-edit-btn" onclick="toggleConstraintsEditor()" title="Edit Constraints">
                        ‚öôÔ∏è
                    </button>
                </div>
            </div>
            <div class="alignment-score">
                <div class="score-circle excellent" id="score-circle">87</div>
                <div class="score-details">
                    <div class="score-label">Alignment Score</div>
                    <div class="score-breakdown">
                        Job: <span id="job-score">85</span> | Culture: <span id="culture-score">90</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Constraints Editor Panel -->
        <div class="constraints-editor" id="constraints-editor">
            <div class="constraints-editor-header">
                <div class="constraints-editor-title">Format Constraints</div>
                <div class="constraints-presets">
                    <button class="preset-btn active" onclick="applyPreset('standard')">Standard</button>
                    <button class="preset-btn" onclick="applyPreset('concise')">Concise</button>
                    <button class="preset-btn" onclick="applyPreset('detailed')">Detailed</button>
                    <button class="preset-btn" onclick="applyPreset('custom')">Custom</button>
                </div>
            </div>
            
            <div class="constraints-grid">
                <!-- Overall Constraints -->
                <div class="constraint-group">
                    <div class="constraint-group-title">Overall Limits</div>
                    <div class="constraint-input-group">
                        <div class="constraint-input">
                            <label>Max Lines:</label>
                            <input type="number" id="total-max-lines" value="29" min="15" max="50" onchange="updateConstraints()">
                        </div>
                        <div class="constraint-input">
                            <label>Max Characters:</label>
                            <input type="number" id="total-max-chars" value="1300" min="800" max="2000" step="50" onchange="updateConstraints()">
                        </div>
                        <div class="constraint-input">
                            <label>Min Characters:</label>
                            <input type="number" id="total-min-chars" value="800" min="500" max="1500" step="50" onchange="updateConstraints()">
                        </div>
                    </div>
                </div>
                
                <!-- Opening Hook -->
                <div class="constraint-group">
                    <div class="constraint-group-title">Opening Hook</div>
                    <div class="constraint-input-group">
                        <div class="constraint-input">
                            <label>Max Lines:</label>
                            <input type="number" id="opening-max-lines" value="3" min="1" max="5" onchange="updateConstraints()">
                        </div>
                        <div class="constraint-input">
                            <label>Max Characters:</label>
                            <input type="number" id="opening-max-chars" value="200" min="100" max="300" step="25" onchange="updateConstraints()">
                        </div>
                    </div>
                </div>
                
                <!-- Value Proposition -->
                <div class="constraint-group">
                    <div class="constraint-group-title">Value Proposition</div>
                    <div class="constraint-input-group">
                        <div class="constraint-input">
                            <label>Max Lines:</label>
                            <input type="number" id="value-max-lines" value="10" min="5" max="15" onchange="updateConstraints()">
                        </div>
                        <div class="constraint-input">
                            <label>Max Characters:</label>
                            <input type="number" id="value-max-chars" value="500" min="300" max="700" step="50" onchange="updateConstraints()">
                        </div>
                    </div>
                </div>
                
                <!-- Company Connection -->
                <div class="constraint-group">
                    <div class="constraint-group-title">Company Connection</div>
                    <div class="constraint-input-group">
                        <div class="constraint-input">
                            <label>Max Lines:</label>
                            <input type="number" id="company-max-lines" value="8" min="4" max="12" onchange="updateConstraints()">
                        </div>
                        <div class="constraint-input">
                            <label>Max Characters:</label>
                            <input type="number" id="company-max-chars" value="400" min="250" max="550" step="50" onchange="updateConstraints()">
                        </div>
                    </div>
                </div>
                
                <!-- Future Impact -->
                <div class="constraint-group">
                    <div class="constraint-group-title">Future Impact</div>
                    <div class="constraint-input-group">
                        <div class="constraint-input">
                            <label>Max Lines:</label>
                            <input type="number" id="impact-max-lines" value="6" min="3" max="10" onchange="updateConstraints()">
                        </div>
                        <div class="constraint-input">
                            <label>Max Characters:</label>
                            <input type="number" id="impact-max-chars" value="250" min="150" max="350" step="25" onchange="updateConstraints()">
                        </div>
                    </div>
                </div>
                
                <!-- Professional Close -->
                <div class="constraint-group">
                    <div class="constraint-group-title">Professional Close</div>
                    <div class="constraint-input-group">
                        <div class="constraint-input">
                            <label>Max Lines:</label>
                            <input type="number" id="close-max-lines" value="4" min="2" max="6" onchange="updateConstraints()">
                        </div>
                        <div class="constraint-input">
                            <label>Max Characters:</label>
                            <input type="number" id="close-max-chars" value="150" min="100" max="200" step="25" onchange="updateConstraints()">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="constraints-actions">
                <div class="constraints-info">
                    üí° Standard format optimized for most job applications
                </div>
                <div>
                    <button class="action-btn secondary" onclick="resetConstraints()">Reset to Standard</button>
                    <button class="action-btn primary" onclick="applyConstraints()">Apply Changes</button>
                </div>
            </div>
        </div>

        <!-- Editable cover letter content -->
        <div class="cover-letter-editor">
            <!-- Opening Hook Section -->
            <div class="section" data-section="opening_hook">
                <div class="section-header">
                    <div class="section-title">Opening Hook</div>
                    <div class="section-stats">
                        <span>Lines: <span class="section-lines">2</span>/3</span>
                        <span>Chars: <span class="section-chars">156</span>/200</span>
                    </div>
                </div>
                <div class="editable-content" 
                     contenteditable="true" 
                     data-section="opening_hook"
                     data-placeholder="Write a compelling opening that hooks the reader...">I am thrilled to apply for the Senior Product Manager position at Coactive AI. Your mission to democratize AI technology aligns perfectly with my passion for building impactful AI products.</div>
            </div>

            <!-- Value Proposition Section -->
            <div class="section" data-section="value_proposition">
                <div class="section-header">
                    <div class="section-title">Value Proposition</div>
                    <div class="section-stats">
                        <span>Lines: <span class="section-lines">8</span>/10</span>
                        <span>Chars: <span class="section-chars">445</span>/500</span>
                    </div>
                </div>
                <div class="editable-content" 
                     contenteditable="true" 
                     data-section="value_proposition"
                     data-placeholder="Highlight your key achievements and relevant experience...">In my 7 years as a Product Manager, I have successfully launched 3 ML-powered products that generated $2M in ARR. At my previous company, I increased user engagement by 40% through AI-driven personalization features and led cross-functional teams of 12+ engineers and designers.

My expertise in product strategy, data analysis, and AI/ML technologies directly aligns with your requirements. I have a proven track record of translating complex technical concepts into user-friendly products that drive business growth.</div>
            </div>

            <!-- Company Connection Section -->
            <div class="section" data-section="company_connection">
                <div class="section-header">
                    <div class="section-title">Company Connection</div>
                    <div class="section-stats">
                        <span>Lines: <span class="section-lines">6</span>/8</span>
                        <span>Chars: <span class="section-chars">342</span>/400</span>
                    </div>
                </div>
                <div class="editable-content" 
                     contenteditable="true" 
                     data-section="company_connection"
                     data-placeholder="Show why you're specifically interested in this company...">What excites me most about Coactive AI is your commitment to making AI accessible to everyone, not just technical experts. Your innovative approach to visual AI and computer vision aligns with my belief that AI should solve real-world problems.

I am particularly impressed by your recent Series A funding and rapid growth trajectory. Your values of innovation, collaboration, and impact mirror my own professional philosophy.</div>
            </div>

            <!-- Future Impact Section -->
            <div class="section" data-section="future_impact">
                <div class="section-header">
                    <div class="section-title">Future Impact</div>
                    <div class="section-stats">
                        <span>Lines: <span class="section-lines">4</span>/6</span>
                        <span>Chars: <span class="section-chars">213</span>/250</span>
                    </div>
                </div>
                <div class="editable-content" 
                     contenteditable="true" 
                     data-section="future_impact"
                     data-placeholder="Describe what you'll bring to the role...">I am eager to bring my product leadership experience to help Coactive AI scale its platform and expand market reach. My background in AI product development and team leadership will contribute to your mission of democratizing AI technology.

I look forward to driving product innovation and user growth in this exciting role.</div>
            </div>

            <!-- Professional Close Section -->
            <div class="section" data-section="professional_close">
                <div class="section-header">
                    <div class="section-title">Professional Close</div>
                    <div class="section-stats">
                        <span>Lines: <span class="section-lines">4</span>/4</span>
                        <span>Chars: <span class="section-chars">142</span>/150</span>
                    </div>
                </div>
                <div class="editable-content" 
                     contenteditable="true" 
                     data-section="professional_close"
                     data-placeholder="Professional closing and call to action...">I would welcome the opportunity to discuss how my experience can contribute to Coactive AI's continued success.

Best regards,
Allen Walker</div>
            </div>
        </div>

        <!-- Action buttons -->
        <div class="cover-letter-actions">
            <button class="action-btn primary" onclick="regenerateCoverLetter()">Regenerate</button>
            <button class="action-btn secondary" onclick="optimizeLength()">Optimize Length</button>
            <button class="action-btn secondary" onclick="togglePreview()">Preview</button>
            <button class="action-btn warning" onclick="exportPDF()">Export PDF</button>
        </div>

        <!-- Live Preview (hidden by default) -->
        <div class="live-preview" id="live-preview" style="display: none;">
            <div class="preview-header">Cover Letter Preview</div>
            <div class="preview-content" id="preview-content"></div>
        </div>
    </div>

    <!-- Auto-save indicator -->
    <div class="auto-save-indicator" id="auto-save-indicator">Saved</div>

    <script>
        class CoverLetterEditor {
            constructor() {
                this.constraints = {
                    max_lines: 29,
                    max_characters: 1300,
                    min_characters: 800,
                    sections: {
                        opening_hook: { max_lines: 3, max_chars: 200 },
                        value_proposition: { max_lines: 10, max_chars: 500 },
                        company_connection: { max_lines: 8, max_chars: 400 },
                        future_impact: { max_lines: 6, max_chars: 250 },
                        professional_close: { max_lines: 4, max_chars: 150 }
                    }
                };
                
                this.presets = {
                    standard: {
                        max_lines: 29, max_characters: 1300, min_characters: 800,
                        sections: {
                            opening_hook: { max_lines: 3, max_chars: 200 },
                            value_proposition: { max_lines: 10, max_chars: 500 },
                            company_connection: { max_lines: 8, max_chars: 400 },
                            future_impact: { max_lines: 6, max_chars: 250 },
                            professional_close: { max_lines: 4, max_chars: 150 }
                        }
                    },
                    concise: {
                        max_lines: 20, max_characters: 900, min_characters: 600,
                        sections: {
                            opening_hook: { max_lines: 2, max_chars: 150 },
                            value_proposition: { max_lines: 6, max_chars: 350 },
                            company_connection: { max_lines: 5, max_chars: 250 },
                            future_impact: { max_lines: 4, max_chars: 200 },
                            professional_close: { max_lines: 3, max_chars: 100 }
                        }
                    },
                    detailed: {
                        max_lines: 40, max_characters: 1800, min_characters: 1200,
                        sections: {
                            opening_hook: { max_lines: 4, max_chars: 300 },
                            value_proposition: { max_lines: 15, max_chars: 700 },
                            company_connection: { max_lines: 12, max_chars: 550 },
                            future_impact: { max_lines: 8, max_chars: 350 },
                            professional_close: { max_lines: 5, max_chars: 200 }
                        }
                    }
                };
                
                this.setupEventListeners();
                this.updateConstraints();
                this.updateScore();
            }

            setupEventListeners() {
                // Add input listeners to all editable content
                document.querySelectorAll('.editable-content').forEach(element => {
                    element.addEventListener('input', () => {
                        this.updateConstraints();
                        this.updateScore();
                        this.showAutoSave();
                    });

                    element.addEventListener('paste', (e) => {
                        // Handle paste events to maintain formatting
                        e.preventDefault();
                        const text = (e.clipboardData || window.clipboardData).getData('text');
                        document.execCommand('insertText', false, text);
                    });
                });
            }

            updateConstraints() {
                let totalLines = 0;
                let totalChars = 0;

                // Update each section
                document.querySelectorAll('.section').forEach(section => {
                    const sectionName = section.dataset.section;
                    const content = section.querySelector('.editable-content').textContent;
                    
                    const lines = content.split('\n').length;
                    const chars = content.length;
                    
                    totalLines += lines;
                    totalChars += chars;

                    // Update section stats
                    section.querySelector('.section-lines').textContent = lines;
                    section.querySelector('.section-chars').textContent = chars;

                    // Check section constraints
                    const sectionConstraints = this.constraints.sections[sectionName];
                    const sectionElement = section.querySelector('.editable-content');
                    
                    if (chars > sectionConstraints.max_chars || lines > sectionConstraints.max_lines) {
                        sectionElement.classList.add('constraint-violation');
                    } else {
                        sectionElement.classList.remove('constraint-violation');
                    }
                });

                // Update total constraints
                const lineCountElement = document.getElementById('line-count');
                const charCountElement = document.getElementById('char-count');
                
                lineCountElement.textContent = totalLines;
                charCountElement.textContent = totalChars.toLocaleString();

                // Update constraint styling
                if (totalLines > this.constraints.max_lines) {
                    lineCountElement.className = 'constraint-value danger';
                } else if (totalLines > this.constraints.max_lines * 0.9) {
                    lineCountElement.className = 'constraint-value warning';
                } else {
                    lineCountElement.className = 'constraint-value';
                }

                if (totalChars > this.constraints.max_characters) {
                    charCountElement.className = 'constraint-value danger';
                } else if (totalChars > this.constraints.max_characters * 0.9) {
                    charCountElement.className = 'constraint-value warning';
                } else {
                    charCountElement.className = 'constraint-value';
                }
            }

            updateScore() {
                // Simulate score calculation (would be real API call in production)
                const content = this.getAllContent();
                
                // Simple scoring simulation
                const jobScore = this.calculateJobAlignment(content);
                const cultureScore = this.calculateCultureAlignment(content);
                const overallScore = Math.round((jobScore * 0.6) + (cultureScore * 0.4));

                // Update score display
                document.getElementById('job-score').textContent = jobScore;
                document.getElementById('culture-score').textContent = cultureScore;
                
                const scoreCircle = document.getElementById('score-circle');
                scoreCircle.textContent = overallScore;
                
                // Update score circle styling
                scoreCircle.className = 'score-circle';
                if (overallScore >= 85) {
                    scoreCircle.classList.add('excellent');
                } else if (overallScore >= 75) {
                    scoreCircle.classList.add('good');
                } else if (overallScore >= 65) {
                    scoreCircle.classList.add('fair');
                } else {
                    scoreCircle.classList.add('poor');
                }
            }

            calculateJobAlignment(content) {
                // Simulate job alignment calculation
                const jobKeywords = ['product', 'manager', 'ai', 'ml', 'strategy', 'data', 'team', 'leadership'];
                const contentLower = content.toLowerCase();
                
                let matches = 0;
                jobKeywords.forEach(keyword => {
                    if (contentLower.includes(keyword)) matches++;
                });
                
                return Math.min(Math.round((matches / jobKeywords.length) * 100), 100);
            }

            calculateCultureAlignment(content) {
                // Simulate culture alignment calculation
                const cultureKeywords = ['innovation', 'collaboration', 'impact', 'growth', 'mission', 'values'];
                const contentLower = content.toLowerCase();
                
                let matches = 0;
                cultureKeywords.forEach(keyword => {
                    if (contentLower.includes(keyword)) matches++;
                });
                
                return Math.min(Math.round((matches / cultureKeywords.length) * 100), 100);
            }

            getAllContent() {
                let content = '';
                document.querySelectorAll('.editable-content').forEach(element => {
                    content += element.textContent + '\n\n';
                });
                return content;
            }

            showAutoSave() {
                const indicator = document.getElementById('auto-save-indicator');
                indicator.classList.add('show');
                
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }
        }

        // Initialize the editor
        const editor = new CoverLetterEditor();

        // Action button functions
        function regenerateCoverLetter() {
            alert('Regenerating cover letter with AI...');
            // Would call API to regenerate content
        }

        function optimizeLength() {
            alert('Optimizing cover letter length...');
            // Would call API to optimize content for constraints
        }

        function togglePreview() {
            const preview = document.getElementById('live-preview');
            const previewContent = document.getElementById('preview-content');
            
            if (preview.style.display === 'none') {
                preview.style.display = 'block';
                previewContent.textContent = editor.getAllContent();
            } else {
                preview.style.display = 'none';
            }
        }

        function exportPDF() {
            alert('Exporting cover letter as PDF...');
            // Would generate and download PDF
        }

        // Constraints Editor Functions
        function toggleConstraintsEditor() {
            const editor = document.getElementById('constraints-editor');
            editor.classList.toggle('show');
        }

        function applyPreset(presetName) {
            // Update active preset button
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            if (presetName === 'custom') {
                return; // Don't change values for custom
            }

            const preset = editor.presets[presetName];
            if (!preset) return;

            // Update form inputs
            document.getElementById('total-max-lines').value = preset.max_lines;
            document.getElementById('total-max-chars').value = preset.max_characters;
            document.getElementById('total-min-chars').value = preset.min_characters;

            // Update section constraints
            Object.keys(preset.sections).forEach(sectionName => {
                const section = preset.sections[sectionName];
                const sectionKey = sectionName.replace('_', '-');
                
                document.getElementById(`${sectionKey === 'opening-hook' ? 'opening' : 
                    sectionKey === 'value-proposition' ? 'value' :
                    sectionKey === 'company-connection' ? 'company' :
                    sectionKey === 'future-impact' ? 'impact' : 'close'}-max-lines`).value = section.max_lines;
                    
                document.getElementById(`${sectionKey === 'opening-hook' ? 'opening' : 
                    sectionKey === 'value-proposition' ? 'value' :
                    sectionKey === 'company-connection' ? 'company' :
                    sectionKey === 'future-impact' ? 'impact' : 'close'}-max-chars`).value = section.max_chars;
            });

            // Apply changes immediately
            updateConstraints();
        }

        function updateConstraints() {
            // Get values from form
            const newConstraints = {
                max_lines: parseInt(document.getElementById('total-max-lines').value),
                max_characters: parseInt(document.getElementById('total-max-chars').value),
                min_characters: parseInt(document.getElementById('total-min-chars').value),
                sections: {
                    opening_hook: {
                        max_lines: parseInt(document.getElementById('opening-max-lines').value),
                        max_chars: parseInt(document.getElementById('opening-max-chars').value)
                    },
                    value_proposition: {
                        max_lines: parseInt(document.getElementById('value-max-lines').value),
                        max_chars: parseInt(document.getElementById('value-max-chars').value)
                    },
                    company_connection: {
                        max_lines: parseInt(document.getElementById('company-max-lines').value),
                        max_chars: parseInt(document.getElementById('company-max-chars').value)
                    },
                    future_impact: {
                        max_lines: parseInt(document.getElementById('impact-max-lines').value),
                        max_chars: parseInt(document.getElementById('impact-max-chars').value)
                    },
                    professional_close: {
                        max_lines: parseInt(document.getElementById('close-max-lines').value),
                        max_chars: parseInt(document.getElementById('close-max-chars').value)
                    }
                }
            };

            // Update editor constraints
            editor.constraints = newConstraints;

            // Update display
            document.getElementById('max-lines').textContent = newConstraints.max_lines;
            document.getElementById('max-chars').textContent = newConstraints.max_characters.toLocaleString();

            // Refresh constraint checking
            editor.updateConstraints();
        }

        function resetConstraints() {
            applyPreset('standard');
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.preset-btn[onclick="applyPreset(\'standard\')"]').classList.add('active');
        }

        function applyConstraints() {
            updateConstraints();
            toggleConstraintsEditor();
            editor.showAutoSave();
        }
    </script>
</body>
</html>
